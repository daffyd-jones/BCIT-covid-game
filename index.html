<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scaleable=0">
    <title>Document</title>
    <style>
        .background {
            background: gray;
            table-layout: fixed;
            border-spacing: 0;
        }

        .background td {
            padding: 0;
        }

        .arrowButt {
            text-align: center;
            background: darkturquoise;
            width: 5vw;
            height: 5vh;
            padding: 1px;

        }

        #textDiv {
            background: lavender;
            border: 1px solid black;
            padding: 1%;
        }

        #scoreDiv {
            background: lavender;
            padding: 3px;
            position: auto;
            align-content: center;
        }

     

        #buttonDiv {
            /*background-color: lavender;*/
            padding: 1%;
            position: auto;
        }

        #gameDiv {
            background: lavender;
            padding: 1%;
            border: solid 1px black;
            position: auto;
        }

        .flex-container {
            background: dimgray;
            padding: 1%;
            position: auto;
        }

        

        body {
            background: rgb(131, 116, 139);
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }


        .lava {
            background: tomato;
        }

        .Upbox {
            background-color:azure;
        }

        .puzbox {
            background-color:chocolate;
        }

        .puzchk {
            background-color: dimgray;
        }

        .box {
            background: teal;
        }

        .wall {
            background: darkslateblue;
        }

        .actor {
            position: absolute;
        }

        .coin {
            background: lightgreen;
        }

        .player {
            background: dimgrey;
        }

        .lost .player {
            background: firebrick;
        }

        .won .player {
            box-shadow: -4px -7px 8px white, 4px -7px 8px white;
        }


        @media (min-width: 1025px) {
            .flex-container2 {
            text-align: center;
            background: dimgray;
            padding: 2%;
            position: auto;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
            }

            .grid-container{
                display: grid;
                grid-template-rows: 10vh;
                grid-template-columns: 6;
            }

            #item1{
                grid-row: 1 /span 2;

            }

            #item2{
                grid-row: 3/ span 5;
            }

            #item3{
                grid-row:8 / span 3;
            }

            .game {
                overflow: hidden;
                max-width: 70vw;
                max-height: 600vh;
                position: relative;
            }

            #gameDiv{
                position: relative;
                left:13vw;
            }

            #buttonDiv{
                display:none;
            }

            #scoreDiv {
                padding:5vh;
            }
        }

        @media (max-width:900px) and (orientation: landscape) {
            .game {
                overflow: hidden;
                max-width: 50vw;
                max-height: 9vh;
                position: relative;
            }
            .grid-container{
                height: 97%;
                display:grid;
                grid-template-columns: 19vw 59vw 20vw;
                grid-template-rows: none;
            }
            .flex-container2{
                position:relative;
                height: 97%;
            }
            #gameDiv{
                height:100%;
            }
            #factText{
                font-size: smaller;
            }
            grid-item:nth-child(1) {order: 3;}
            grid-item:nth-child(2) {order: 2;}
            grid-item:nth-child(3) {order: 1;}
            #item3{
                grid-column: 1 / span 1;
            }
            #item2{
                grid-column: 2 / span 1;

            }
            #item1{
                grid-column: 3 / span 1;


            }
            #buttonDiv{
                padding:1px;
            }
            #tbItem{
                position: absolute;
                bottom: 10vh;
                /*background-color: lavender;*/
            }
            #stuffDiv{
                /*background-color: lavender;*/
                position: relative;
                height:97%;
                margin:1%;
            }
          
        }
        
    
        @media (min-width: 668px) and (max-width: 1024px) {
            .game {
                overflow: hidden;
                max-width: 95vw;
                max-height: 60vh;
                position: relative;
            }
        }
        @media (max-width:668px) {
            .game {
                overflow: hidden;
                max-width: 90vw;
                max-height: 65vh;
                position: relative;
            }
            
            .flex-container2 {
            background: dimgray;
            padding: 2%;
            position: auto;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: stretch;
            }
            #buttonDiv{
                display:grid;
                grid-template-columns: 8;
                text-align: center;
            }
            #tbItem{
                grid-column: 3 / span 6;
            }
        }

        @media (max-width:500px) {
            .game {
                overflow: hidden;
                max-width: 90vw;
                max-height: 65vh;
                position: relative;
            }
            
            #scoreDiv{
                display:none;
            }

            #factText{
                display:none;
            }
            #levelText{
                font-size: smaller;
            }
            #livesText{
                font-size: smaller      ;
            }
            
            .flex-container2 {
            background-color: dimgrey;
            padding: 2%;
            position: auto;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: stretch;
            }
        }
    </style>
</head>

<body>


<div class="grid-container">


    <grid-item class="item1">
        <div id="stuffDiv">
        <p id="levelText"></p>
        <p id="livesText"></p>
        </div>
    </grid-item>


    <grid-item id="item2">
        <div class="flex-container2">
            
            <div id="gameDiv">
                <div id="loseDiv">
                    <h3>Sorry you ran out of lives</h3>
                    <h5>Click the button below to start again</h5>
                    <button id="startButt" onclick="runGame(GAME_LEVELS, DOMDisplay);">Click to start!</button>
                </div>
                <div id="homeDiv">
                    <h3>Welcome to Covid Game</h3>
                    <h5>Avoid other people and mucus while collecting toilet paper</h5>
                    <button id="startButt" onclick="runGame(GAME_LEVELS, DOMDisplay);">Click to start!</button>
                </div>
            </div>
        </div>
    </grid-item>
    


    <grid-item id="item3">
        <div>
            <div id="scoreDiv">
                <h7 id="factText"></h7>
            </div>
        </div>
        
        <div id="buttonDiv">
            <table id="tbItem">
                <tbody>
                    <tr>
                        <td>&nbsp;</td>
                        <td>
                            <div class="arrowButt" ontouchend="upButtF()" ontouchstart="upButtT()">^</div>
                        </td>
                        <td>&nbsp;</td>
                    </tr>
                    <tr>
                        <td>
                            <div class="arrowButt" ontouchend="leftButtF()" ontouchstart="leftButtT()"><</div>
                        </td>
                        <td>&nbsp;</td>
                        <td>
                            <div class="arrowButt" ontouchend="rightButtF()" ontouchstart="rightButtT()">></div>
                        </td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>
                            <div class="arrowButt" ontouchend="downButtF()" ontouchstart="downButtT()">v</div>
                        </td>
                        <td>&nbsp;</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </grid-item>
</div>


    <script>
        
        //this is a level template
        let simpleLeveldddPlan = [
            '......................\n' +
            '.###################..\n' +
            '.#.................#..\n' +
            '.#.&........p......#..\n' +
            '.#.................#..\n' +
            '.#.@...............#..\n' +
            '.#.................#..\n' +
            '.###################..\n' +
            '......................\n',

            '........................................................................................\n' +
            '.######################################################################################.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.######################################################################################.\n' +
            '........................................................................................\n',

            
            
            
            '........................................................................................\n' +
            '.######################################################################################.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.#....................................................................................#.\n' +
            '.######################################################################################.\n' +
            '........................................................................................\n'];

        //array of game levels
        let GAME_LEVELS = [
            
            
        '........................................................................................\n' +
            '.######################################################################################.\n' +//1
            '.#.o.o.o.o.o.o.o.o.o.o.o.o.o.o.o.o.o.o.o.#................o..o..o..o..................#.\n' +
            '.#o.o.o.o.o.o.o.o.o.o.o.o.o.o.o.o.o.o.o.o#.o.o.o.o.o........................=.........#.\n' +
            '.#..................+#...................#.o.o.o.o.o.......oo.oo.oo...................#.\n' +//good
            '.#....|....=...............|.....=.......#o.o.o.o.o.o###########################......#.\n' +
            '.#..................+#...................#o.o.o.o.o.o#.o.o.o.o.o.#..=.................#.\n' +
            '.#################..+#...#################.o.o.o.o.o.#o.o.o.o.o.o#....................#.\n' +
            '.#..................+#................+++#o.o.o.o.o.o#.....#.....#........=.###########.\n' +
            '.#.......=..............................+#############...=.#...=.#..............o.o.o.#.\n' +
            '.#................+++#...................#o.o.o.o.o.o#.....#.....#.......+.......o.o..#.\n' +
            '.#...#################################...#...........#.....#.....#........+......+#+#+#.\n' +
            '.#.o.o.o.o.o.o.o.o.o.#.o.o.o.o.o.o.o.o...#....=#..=..#.....#.....#.......+............#.\n' +
            '.#..............................=........#.....#.....#=....#.=...#....................#.\n' +
            '.#.o.o.o.o.o.o.o.o.o.#.o.o.o.o.o.o.o.o...#.....#.....#.....#.....#............#+o.o.o.#.\n' +
            '.#...#############...#...#################.....#.....#.....#..................+#.o.o.o#.\n' +
            '.#.........#.+++.....#...................#=....#=....#.....#...........#.o.o.o#+o.o.o.#.\n' +
            '.#.@.......#o.o......=.........................#...........#=ooooooooo.#o.o.o.+#.o.o.o#.\n' +
            '.#.........#.o.o.....#.........................#o.o.o.o.o.o#+++++++++++#.o.o.o#+o.o.o.#.\n' +
            '.######################################################################################.\n' +
            '........................................................................................\n',

            '........................................................................................\n' +
            '.######################################################################################.\n' +//2
            '.#.....#.o...o.o...o.o.o.o+++#...o..o..........+++........+++.......#.&.#....o..+++..o#.\n' +//1up
            '.#..@..#..o..o..o.o...o.o..++#..o.oo.o..............................#...#...o.o..+..o.#.\n' +
            '.#.....#...o.o...o...o.o.o..+#.o..oo..o..|#..........=#........=#o.....o#..o...o...o..#.\n' +
            '.#.....#....oo...............#o..o..o..o..o.o.....|...#.........#o.o.o.o#.o.....o.o...#.\n' +
            '.#....=#.....#...............#..o.o..o..o#.o......#o.o#oo.o.o.oo#########o.......o...+#.\n' +
            '.#.....#.....#######..####################o.o.....#o.o##########o.o.o................+#.\n' +
            '.#=..........#o.o.........#oo.oo.oo.oo.oo#####..######oo.oo.oo.#.o.o..................#.\n' +//good
            '.#.....#.....#.o..........#.oo..o..o..oo.#....................o#o.o.o.....#o.o.o.o.o.o#.\n' +
            '.#...........#o.o.....=...#..............=...........oo.oo.oo.o#######....#############.\n' +
            '.#...........#.................+.....................###########..............=#o.oo.o#.\n' +
            '.################...................=#.....+..............o.o#........................#.\n' +
            '.#.o.oo.oo.oo..|............................+....#........o.o#...+..........+.........#.\n' +
            '.#.oo.oo.oo.o.............#=.....................######..#####.......o#o........o#o...#.\n' +
            '.#.o.oo.oo.oo#..........=.#oo.oo.oo.oo.oo#......=#.o.o...............o#o........o#o...#.\n' +
            '.#.oo.oo.oo.o.............#.oo..o..o..oo.#o.oo.oo#o.o..........o#o.........o#o.......o#.\n' +
            '.#.o.oo.oo.oo.............#oo.oo.oo.oo.oo#oo.oo.o#.o.o.........o#o.........o#o.......o#.\n' +
            '.######################################################################################.\n' +
            '........................................................................................\n',

            '........................................................................................\n' +
            '.######################################################################################.\n' +//3
            '.#oo.oo.oo.oo.#o.o.o.#.....#o.oo.oo.oo.oo.oo.oo.#.o.o.o#+o.o.o.#.o.o..o.o....o.o.o.+++#.\n' +
            '.#............#.o.o.o#.....#....................#o.o.o.+#.o.o.o#.o.o..o.o.....o.o.o.++#.\n' +
            '.#.....#......=o.o.o.#=............#....=#=.....#..........................+...o.o.o.+#.\n' +
            '.#..=.........#.................=..#.......................................+....o.o.o.#.\n' +
            '.#.....#......#.................o..#...................#=......#####.............o.o.o#.\n' +//good
            '.#.....#..=..........#.........o.o.#o....#......#......=.......#o.o...................#.\n' +
            '.#.....=......#o.o.o.#........oo.oo#....o#......#......#....o.o#o.o...................#.\n' +
            '.#o.o.o#......########.....#########o....#......#..........o.o.########...####...######.\n' +
            '.#.o.o.#..........=...................o.o#......#.........o.o.o#...................o.o#.\n' +
            '.#o.o.o#.....................=........####....#######....#######.....................o#.\n' +
            '.############...####......######.................o#...........####.......=.........####.\n' +
            '.#o.o.o#........o.o#...........#...............o.o#...........#.......................#.\n' +
            '.#..............o.o#...........=.....#####....#####...........=......o#o.....o#o......#.\n' +
            '.#..........########.....+...........#o.o#........#...............#o..#..o#o..#..o#o.o#.\n' +
            '.#.....#.......................#.....#.o..............#.......#...#..o#o..#..o#o..#.o.#.\n' +
            '.#..@..#.......................#.....#o.o.............+o.o.o.o#...#+++++++#+++++++#o.o#.\n' +
            '.######################################################################################.\n' +
            '........................................................................................\n',

            '........................................................................................\n' +
            '.######################################################################################.\n' +//4
            '.#...........o.........|..........++...o.o#o.o.o........o.o.#oo.oo.oo.oo#....o.o.o.o.o#.\n' +
            '.#.&..........o......o...o..|......+...o.#.o.o..........o.o#.oo.o.o.oo.#.....o.o.o.o.#.\n' +//1up
            '.#......=#+....o..|.o.....o............o.o#..o.....+#########..=........#......o.o.o..#.\n' +
            '.#.......#++.|..o............o..........o.#.........#o.o..o.o#####......#.............#.\n' +//good
            '.#oo.oo.o##########################...#####........=#..................=###...........#.\n' +
            '.#o.oo.oo#....................................................................#=......#.\n' +
            '.#########...................................................+................#o.o.o.o#.\n' +
            '.#.......#....=#...............................................+..............#.o.o.o.#.\n' +
            '.#.@...........########..#######+........+#...................................#o.o.o.o#.\n' +
            '.#...........++#o.o........o.o.#++......++############+.......................#########.\n' +
            '.###############.o..........o.o####...#####.o.o.o.o.o#+++........######..#####o.o.o.o.#.\n' +
            '.#o.o.o.o.o.o.o................#.............o.o.o.o.######..####.....................#.\n' +
            '.#.....................=.#..=..#.........=#=.........#|.........#.o.o.................#.\n' +
            '.#................#..=........+#...o.o.o..|..........#.....o.o.o######.......o.o#....=#.\n' +
            '.#.o.o.o.o.o#=...........#.o.o.#..o.o.o.o...................o.o.#o.o........o.o.#.o.o.#.\n' +
            '.#o.o.o.o.o.#o.o.o#o.oo.o#o.o.o#.o.o.o.o.o.................o.o.o#..........o.o.o#o.o.o#.\n' +
            '.######################################################################################.\n' +
            '........................................................................................\n',

            '........................................................................................\n' +
            '.######################################################################################.\n' +//5
            '.#+.+.+.+.#......#o.o.............o#o.o.o#.......o.o#+++++++#...........o#oo.oo.oo.oo.#.\n' +
            '.#.o.o.o.o#......#o.o.............o#o.o.o#.......o.o#o.o.o.o#...o#o......#............#.\n' +
            '.#..o.o.o........#.....o.o#.....=###...###......#####............#..o#o|o#o..#######..#.\n' +
            '.#.o.o.o.........#....=####......#.....#o.......................o#o|.#.......#oo.oo...#.\n' +
            '.#o.o.o.o.#...............o#.....#=....#o...###o.o.o.......o#o......o#o......#.o.o....#.\n' +
            '.#.+.+.+.+#................#++...............o#.o.o........o#o...............=........#.\n' +//good
            '.##########...............o#+++..............o#o.o.o.......o#o..............o#........#.\n' +
            '.#+++++################################################..#########..#.......o#........#.\n' +
            '.#...........#o.oo.o.oo.o#o.oo.o.oo.o#oo.oo.oo.oo.#........o.o#.....#o......o=........#.\n' +
            '.#...........#...........#........................#=................###...#######...###.\n' +
            '.#.....=.....#.....=.....#............................................................#.\n' +
            '.#.....#.....=.....#.....=.....#.....#oo.oo...................#..|.....o#o.....o#o...+#.\n' +
            '.#.....#.....#.....#.....#...........########.....#...........#.o#o.#.|.#..o#o|.#....+#.\n' +
            '.#.....=.....#.....=.....#.........=.#o.o.o.#....=#.....+.....#.o#o.#..o#o|.#..o#o...+#.\n' +
            '.#.....#...........#.................#.o.o.o.....+#o.o.o#o.o.o#.....#......o#o.......+#.\n' +
            '.#..@..#...........#.................#o.o.o.....++#+++++#+++++#o.o.o#..............+++#.\n' +
            '.######################################################################################.\n' +
            '........................................................................................\n',


            '........................................................................................\n' + 
            '.######################################################################################.\n' +//6
            '.#o.o.o.o.o.o.o.............o.o.#oo.oo.........................o.o.o#oo.oo.o.oo.o.oo.o#.\n' +
            '.#.o.o.o.o.o.o...............o.o#..o............................o.o.#o.o..o.oo.o.oo.o.#.\n' +//good
            '.#o.o.o.o.o.o.o...######...#####.oo.o.oo#..............o.o#####o.o.o#oo.oo.o.oo.oo.o.o#.\n' +
            '.################|#.........ooo#oo.o.oo.#.|...........o.o.#o.o#######...............=.#.\n' +
            '.#oo.oo.oo#......#............o###################...######....o.o.o######.....########.\n' +
            '.#.o.oo.o.#.........................o.o.o#o.oo.o........=.#..........oo#........#o.o.o#.\n' +
            '.#....................................................................o#.=......#.o.o.#.\n' +
            '.#..............#.........ooooo#o.o.....oo.oo..................+......o####.....#o.o.o#.\n' +
            '.#.o.oo.o.#|#...#......=#############..#######.............+..........o#|.......#....=#.\n' +
            '.#oo.oo.oo###...#...........oo.oo#oo....o.o#oo........................o#..............#.\n' +
            '.##########..................o.o.#.....=...#o.........................................#.\n' +
            '.#o.o.o#..................|########........#o........=#...............................#.\n' +
            '.#..............+..............oo#.#......=####=....######.o.#######...#####..=.......#.\n' +
            '.#................+.............o#|........#oo...........o###o.o.o........o######o.o.o#.\n' +
            '.#.....#oo.o#....................o.........oo...........o.o#o.o.o.o.......o.o.o.#.o.o.#.\n' +
            '.#..@..#o.oo#............oo#oo............................o#.o.o.o.o..&..o.o.o.o#o.o.o#.\n' +//1up
            '.######################################################################################.\n' +
            '........................................................................................\n',

            '........................................................................................\n' +
            '.######################################################################################.\n' +//7
            '.#.....#.o.o.#....|.....|..#+++..........o.o.o.o.o......=.......#..ooooo..ooooo..ooooo#.\n' +
            '.#..@..#o.o.o#.............#++..................................#.....=.........=.....#.\n' +
            '.#....+#...................#+...........##########............++#..ooooo..ooooo..ooooo#.\n' +//good
            '.#.....#...................#.................................+++#..#####..#####..######.\n' +
            '.#+....#.....#.............#............................#########...................=.#.\n' +
            '.#.....#.....#...................#..............................#..............#####..#.\n' +
            '.#...........#....=..............#+++...........++...........................|.o.o.o..#.\n' +
            '.#...........#...................#...............++...............|...o.o.o.....o.o...#.\n' +
            '.#+++++++++++##########.....######........#.......++............#######################.\n' +
            '.#...........#.o.o.o.o...........#........#...........................................#.\n' +
            '.#.=.........#..o.o.o...................=.#.................................|.........#.\n' +
            '.#...=.#.o...#.o.o.o.o....................#.....=.............#o..|o#o...o#o...o#o..|o#.\n' +
            '.#o.o.o#..o..#..o.o.o............#........#................=..#o...o#o..|o#o...o#o...o#.\n' +
            '.#.o.o.#...o.#.o.o.o.o.......=...#.=......#o.o.o.o.o.o.o.o.o.o#o...o#o|..o#o...o#o...o#.\n' +
            '.#o.o.o#.o...#...................#.o.o.o.o#..=................#o|..o#o...o#o...o#o...o#.\n' +
            '.#.o.o.#..o......................#o.o.o.o.#.o.o.o.o.o.o.o.o.o.#...............|.......#.\n' +
            '.#o.o.o#...o.....................#.o.o.o.o#o.o.o.o.o.o.o.o.o.o#...................|...#.\n' +
            '.######################################################################################.\n' +
            '........................................................................................\n',
            
            '........................................................................................\n' +
            '.######################################################################################.\n' +//8
            '.#o.o.o..o.o.o.o.#o.o.o............oo..oo=..oo..o.o.o.o.o.o.o#o.o.o.o#oo..oo..oo..oo..#.\n' +
            '.#.o.o...o.o.o.o.#.o.o.o........|..oo..oo...oo..o.o.o.o.o.o.o#.o.o.o.#..oo..oo..oo..oo#.\n' +//good
            '.#..o..#.......=.#o.o.o...........#############++++++++++#####o.o.o.o#.............=..#.\n' +
            '.##########..#####.o.o.o..........#...........############...#.o.o.o.#..........#######.\n' +
            '.#...............#o.o.o.|.........#..........................#......=#.o.o#o...o#o...o#.\n' +
            '.#...............###########..#####..........................#=......#o.o.#.o.o.#o...o#.\n' +
            '.#.....#.........#...........................................#............#o...o#o...o#.\n' +
            '.#.@...#.........#...........................................#.o.o.o...............=..#.\n' +
            '.#######............########................#=...............#.o.o.o..................#.\n' +
            '.#o.o.o#............#o.o.o.o...###########.##........................##################.\n' +
            '.#.o.o.#++++++++++++#.o.o.o....#o.o.o.o.o#|..........++..............#|.............&.#.\n' +//1up
            '.#.....#oo..oo..oo..############.o.o.o.o...................++........#......o#o.......#.\n' +
            '.#....=#..oo..oo..oo#o..o#.o.o.#..o.o.o...............+++....................#........#.\n' +
            '.#.....#.........=..#.oo.#..o..############.........++++................o#o.o#o.|#o.o.#.\n' +
            '.#=....#............#o..o#.o.o........................+..............#...#.......#.o.o#.\n' +
            '.#.................................................................++#..o#o......#o.o.#.\n' +
            '.#.............................................#..................+++#.....|..........#.\n' +
            '.######################################################################################.\n' +
            '........................................................................................\n',

            '........................................................................................\n' +
            '.######################################################################################.\n' +//9
            '.#..........#.o.o...........o.o.#o.o.o......................o.o.o#o.o.o........o.o.o.o#.\n' +
            '.#..........#o.o.o.........o.o.o#.o.o.......................o.o.o#.o.o.o........o.o.o.#.\n' +
            '.#.o.o.#....#######.o.......o.o.#o.o.o....o.o.o.#.......=........#o.o.o........o.o.o.o#.\n' +
            '.#o.o.o#.....o.o.o#o.o.....o.o.o#######..########|...#...........=#######=......o.o.o.#.\n' +
            '.#######..........#####...#######o.o.o........o.o#.................o.o.o#.o......o.o.o#.\n' +
            '.#.....#..........#o.o.......o.o#............o.o.#o.........+.......o.o.#o.o......o.o.#.\n' +//good
            '.#.@........+.....#.o.o.....................#########................########.......=.#.\n' +
            '.#................#######...........=#......#o.o.o.o#..............=#o.o.o.........o.o#.\n' +
            '.#######........................o.o.o#......#o.o.o.o#o.oo.o#........#.o.o.........o.o.#.\n' +
            '.#o.o.o#.......................#######.............=########........###..........o.o.o#.\n' +
            '.#.o.o.######..######...............................#o.o.o#|...........#......o.o.o.o.#.\n' +
            '.#....=#o.o.....o.o.#|.#=...................#.......#..................#.....o.o.o.o.o#.\n' +
            '.#.....#.o.......o.o#######..#########.o.o.o#...................#####..#...############.\n' +
            '.#.....=...........+#...............=###########................#.....................#.\n' +
            '.#................++#o.o.o.o.o.o.o.o.o.o.o.o.o.#o.oo.oo.oo#..o.o#.oo.oo.oo.oo.oo.oo.oo#.\n' +
            '.#...............+++#.o.o.o.o.o.o.o.o.o.o.o.o.o#oo.oo.oo.o#.o.o.#oo.oo.oo.oo.oo.oo.oo.#.\n' +
            '.######################################################################################.\n' +
            '........................................................................................\n',
            
            '........................................................................................\n' +
            '.######################################################################################.\n' +//10
            '.#.......#.oo.oo..oo.o#.o.oo.o.o.......++++#+.o.oo.............#................oo.oo.#.\n' +
            '.#...@...#o.o.oo.oo.o.#..o.oo.o.........+++#++.o...#...........=................oo.o.o#.\n' +
            '.#.......#..=.........#...........o#.....++#+++.........#o.oo.o#o.oo.#.........########.\n' +
            '.#.....=.#...........=#........o.oo#......+#............##############.............+++#.\n' +
            '.#.......#............#........oo.o#.......#.....#........oo.o#o.oo.......|..........+#.\n' +
            '.#.......######.............#########.........................#..........=#...........#.\n' +//good
            '.#.......#..|.....#...........o.++#............................#..........#...........#.\n' +
            '.#..............=.#######....o.o.+#.....=########...........=..###........#############.\n' +
            '.####.............#...........o.o.#.o.o.o#o.oo................................+oo.oo.o#.\n' +
            '.#.............................o.o#o.o.o.#oo.o...|........+++#................+oo.o.oo#.\n' +
            '.#.o.o.o.o.o#+..................##################.........++#........#...............#.\n' +
            '.#o.o.o.o.o.#+++............#.....oo.oo.oo.oo.+++#...........#........#...........=...#.\n' +
            '.##################.........#..................++#######.....##########.......++......#.\n' +
            '.#o.o.o.o.#.................=.......#...=.#.....+#oo#=.......#o.o.o.o.#........++.....#.\n' +
            '.#.o.o.o.o#.................#.....=.#.....#.=....#..........+#.o.o.o.o................#.\n' +
            '.#..............|.#.........#oo.ooo..oo.oo#................++#...........=#...........#.\n' +
            '.#................#.........#oo.oo..ooo.oo#...............+++#++++++++++++++++++++++++#.\n' +
            '.######################################################################################.\n' +
            '........................................................................................\n',
            
            '........................................................................................\n' +
            '.######################################################################################.\n' +//11
            '.#+++..................+++#o.o...........+#............+++#o.oo.o.oo.#o.oo.o.oo.......#.\n' +
            '.#++....................++#.o.............#.............++#.o.oo.o.oo#.o.oo.o.oo......#.\n' +
            '.#+........=#............+#o.o......#.....#.....=#.......+#.........=#oo.oo.oo.o......#.\n' +
            '.#o.o.oo.o.o######..#######....+....#.=...#......#........#..=.......############|....#.\n' +
            '.#.o.oo.o.oo#.............#........=#.....#.=....#........#######....#................#.\n' +
            '.############.......................#............#oo.oo.oo............................#.\n' +
            '.#..@..#............................#............#.o.oo.o........................######.\n' +
            '.#.....#..................#+++++++++#######..##############..........++...............#.\n' +
            '.#.....#..............|##############o.o#.....o.oo.o.o#...............++..............#.\n' +
            '.#................................o.o.o.#o.o.oo.......#.................#.....=#=.....#.\n' +
            '.#...................................o.o########.....=#=......#........=#......+..=...#.\n' +
            '.########......=#.....#o.o.o............#oo.oo.|......#...=...#.........#...=..+......#.\n' +
            '.#++++++#.......=.....######...........=#.o.o.........#......=#.........#......+...=..#.\n' +
            '.#o.o.o.#.......#.....#o.o.o............#..o..........#oo.oo.o#...=.....#..=...+o.o.o.#.\n' +
            '.#..............#.....................................#o.oo.oo#................+.o.o.o#.\n' +
            '.#..............#.....................................#oo.oo.o#................+o.o.o.#.\n' +
            '.######################################################################################.\n' +
            '........................................................................................\n',

            '........................................................................................\n' +
            '.######################################################################################.\n' +//12
            '.#.oo........#++...............#.oo.......++#.........oo.oo.oo#.o.o.o.o...oo.oo.oo.oo.#.\n' +
            '.#...oo.....#................=.#.oo........+#.oo.oo....o.oo.o.#..o.o.o..&...o..o..o...#.\n' +//1up
            '.#.oo..............+++###..###########......#.oo.oo...........#.o.o.o.o...oo.oo.oo.oo.#.\n' +
            '.#...oo.............++#.....+#...ooo.#.....=#.............+...#.......................#.\n' +
            '.#.oo........#.......+#.....+#.......#......#................=#.......................#.\n' +
            '.#############........#..........ooo.#......#.................#.=.....................#.\n' +
            '.#.o.o.......#.=......#++............#...=..#.=.....#.o.o.o.o.#.................+.....#.\n' +
            '.#.o.o................#+....#....ooo.#......#.......####.o.o.o#..........=............#.\n' +
            '.#..o.................#.....#........#......#...........#######.......................#.\n' +
            '.#.o.o.......#........#....++#########.=....#...........o.o.o.#.......+...............#.\n' +
            '.#.o.o.......#........#.....+#o.o.o.o#......#.+........o.o.o.o#....................=..#.\n' +
            '.#############........#........o.o.o.#......#.++......o.o.o.o.#..............+........#.\n' +
            '.#...........#......=.#++............#..=...#.++++.....o.o.o.+#.......................#.\n' +
            '.#...........#........#+.....#o.o.o.o#......#...............++#.......................#.\n' +
            '.#....................#......#########......########.....###########.....##############.\n' +
            '.#.@..................#............................................................=..#.\n' +
            '.#...........#........#...............................................................#.\n' +
            '.######################################################################################.\n' +
            '........................................................................................\n',

            '........................................................................................\n' +
            '.######################################################################################.\n' +//13
            '.#+++............#+++....v.........................................+++#+......v.......#.\n' +
            '.#++.............#++................................................++#++.............#.\n' +
            '.#+.o.o..#.......#+...........#######.......#####....................+#+++............#.\n' +
            '.#.......#......=#...............v..#=......#+++...............o......#++++...........#.\n' +
            '.#....+++#.......#.o.o..............#......=#++......+++.....o...o....#.oo...........+#.\n' +
            '.#.....++#.......#.o.o.o............#.=.....#+........+++++.o......o.+#.............++#.\n' +
            '.#.o.o..+#=......#.=.o.o............#.....=.#..=........++....o..o..++#............+++#.\n' +
            '.#.......#.......#..................#..=....#.......o.o.+....o..o..+++#...........++++#.\n' +
            '.#+++.o..#.......############.v.....#....=..#...o.o.....+++.o.o.....++#+...........oo.#.\n' +
            '.#++.....#...=...#.o.o.o.o.##.......#...=...#+...o.o.+++++.o...o.....+#++.............#.\n' +
            '.#+.o.o..#.......#.o.o.o.o.##.......#.......#++.o.o.o.+++...o.o....=..#+++............#.\n' +
            '.#.......#.................##.......#.......#+++.......++....o.....+++#++++...........#.\n' +
            '.#....+++#....=.............#.......#.......############+++.........++#..oo..........+#.\n' +
            '.#.....++#.......#.........##.......#.......#..o.o.o.o.#++...........+#.............++#.\n' +
            '.#......+#.......############.......#.......#...o.o.o..#+..........................+++#.\n' +
            '.#.......#..........................#............o.o...#++........................++++#.\n' +
            '.#...@...#..........................#.............o....#+++...........#..........+++++#.\n' +
            '.######################################################################################.\n' +
            '........................................................................................\n',

            '........................................................................................\n' +
            '.######################################################################################.\n' +//14
            '.#++.|..........v....o.o.o.#.......v....................o.o.o...............oo.oooo.oo#.\n' +
            '.#+.................o.o.o..#.......................|.....o.o.................o.o..o.o.#.\n' +
            '.#+....+#+.o.o.o.o..+..o.o.#............................o.o.o...............oo.oooo.oo#.\n' +
            '.#+...++#.o.o.o.o.o.+++++++#...|........|.........#.###.............=.......###########.\n' +
            '.#+....+#+.o.o.o.o.o.++++++#......................#...o.o.o................|o.o.o.o.o.#.\n' +
            '.##+....+.o.+.o.o.o.o.+++++#......................#....o.o....|...o.o.o....#.o.o.o.o.o#.\n' +
            '.##++...+..+.o.o.o.o.o.++++#..=.......................o.o.o........o.o................#.\n' +
            '.##+....+.+.....+..........#......................................o.o.o...............#.\n' +
            '.#+....+#+.....+#+.......................####.....#####################################.\n' +
            '.#+...++#+......+........................#.......................=#+++#oo.oo.oo.oo.oo.#.\n' +
            '.#+....+#++...............................#####..............oo.oo..++#.o..o..o..o..o.#.\n' +
            '.##+....++++........+++++++########........................#..o.o.o..+#...............#.\n' +
            '.##++...++.o.o.o.o.o.++++++#..o.o.+.............=.###......#.o.o.oo.o.#............=..#.\n' +
            '.##+....+.o.o.o.o.o.o..++++#.o.o..+...............#........#..........#......=#.......#.\n' +
            '.#+.....#+.+.o.o.o.o.o..+++#..o.o.+..#####+.......#.o.o.o.+#.........=#......+#o..o..o#.\n' +
            '.#+.....#.+.o.o.o.o.o.o..++#..........o.o#++.........o.o.++#................++#.o.o.o.#.\n' +
            '.#+..@..#+.+..............+#..........o.o#+++.........o.+++#...............+++#oo.o.oo#.\n' +
            '.######################################################################################.\n' +
            '........................................................................................\n',

            '........................................................................................\n' +
            '.######################################################################################.\n' +//15
            '.#ooo.oo.oo.oo.oo.oo.oo.oo.+++.oo.oo.oo.oo.oo.oo.ooo#.o..o..o.o#o.o.o#................#.\n' +
            '.#..........................+.......................#o.o.o.o.o.#.o.o.#................#.\n' +
            '.#####....oo#=........................#............o####..######............=#.......=#.\n' +
            '.#o.o....#######o.o.|#...........o.o.o#######o.o.o.#o.o.....#...........o.o.o#........#.\n' +
            '.#.o.......o.o.o###########...#########o.o.o########........#........#########.=......#.\n' +
            '.#o.........o.o.#=.............o.o.o.o#......o.o.o..........|...........o.o.o#o.o.oo.o#.\n' +
            '.#o........########o.o...+..............................................o.o.o#oo.o.o.o#.\n' +
            '.#.o.........o.o.o#.o.....+...............................#=...........######|#########.\n' +
            '.#o.......|.....o.#o.o............######..######........o.#&...............oo.oo.oo.oo#.\n' +//1up
            '.#.......=#=.....####..........o.o#o.o......o.o#o.o....#######o.o.........o..o..o..o..#.\n' +
            '.#o.o.o.........o#............o.o.#=...........######...o.o.o######.....oo.oo.oo.oo.oo#.\n' +
            '.########o.o.o#o.#...........#######......o.o.o#.................=#....|###############.\n' +
            '.#......######|###.....#....=#o.o.o........o.o........o#..........#........o.o.o.o.o.o#.\n' +
            '.#.@....#o.o.o.o.#....=#..............................o#....=#....#.......o.o.o.o.o.o.#.\n' +
            '.#.....................#o.o.o.o.o.o#o.o.o#=.o.o........................#.o.o.o.o.o.o.o#.\n' +
            '.#..........oo.oo.oo.o.#o.o.o#o.o.o#.o.o...o.o.#oo.ooo.o.ooo.#oo.oo.o.o#o.o.o.o.o.o.o.#.\n' +
            '.######################################################################################.\n' +
            '........................................................................................\n',

            '........................................................................................\n' +
            '.######################################################################################.\n' +
            '.#.........................#...............|..................ooooo...................#.\n' +
            '.#.........................#..............................................oooooo......#.\n' +
            '.#.........................#.....................................oooooooooooooo.......#.\n' +
            '.#.........................#.............|............................................#.\n' +
            '.#...ooo...................#.........-........-.......................................#.\n' +
            '.#..++++++.................#......-.............-..........++++++++...................#.\n' +
            '.#....oo...................###########.........####+.......++++++++...................#.\n' +
            '.#...................#.....#...oo....#.........#####.....o.++++++++...................#.\n' +
            '.#...oo..............#....=#.........#.........#####.......++++++++...................#.\n' +
            '.#.......oo..........#ooooo#.........#.........####........++++++++...................#.\n' +
            '.############........#.....#.....#####.........####...................................#.\n' +
            '.#.......vv..........#.....o...................####......................ooooooo......#.\n' +
            '.#...................#.....|...................####.vvv.....................o.........#.\n' +
            '.#.@.........#.......#.........................###+......................ooooooo......#.\n' +
            '.#...........#.......#.........................###+.........................o.........#.\n' +
            '.#...........#.......#.....o...................#oo..........................o.........#.\n' +
            '.#ooooooooooo#.......#.....o...................#oo..........................o.........#.\n' +
            '.######################################################################################.\n' +
            '........................................................................................\n',

            '.......................................\n' +
            '.#####################################.\n' +
            '.#vv...vv..|..|..#+++....v....=...ooo#.\n' +
            '.#...o...........#++..........=...ooo#.\n' +
            '.#..o.o..#.......#+...........########.\n' +
            '.#.......#......=#...............v..##.\n' +
            '.#oo...oo#.......#.o+o+.............##.\n' +
            '.#.......#.......#.o+o+o............##.\n' +
            '.#oo...oo#=......#+++o+o............##.\n' +
            '.#.......#.......#..................##.\n' +
            '.#ooo.ooo#.......############.......##.\n' +
            '.#oo...oo#...=...#|o+o+o+o|##.......##.\n' +
            '.#o.o.o.o#.......#.o+o+o+o.##.......##.\n' +
            '.###...###..........+.+.+..##.......##.\n' +
            '.#+++o+++#.................##.......##.\n' +
            '.#++.o.++#....=..#.........##.......##.\n' +
            '.#+..o..+#.......############.......##.\n' +
            '.#=......#..........................##.\n' +
            '.#...@.=.#..........................##.\n' +
            '.#####################################.\n' +
            '.......................................\n',

            '.............v........\n' +
            '..#.@..............#..\n' +
            '..#..........o.....#..\n' +
            '..#.........ooo....#..\n' +
            '..#........ooooo...#..\n' +
            '..#=....=.....=....#..\n' +
            '..#oooooooooooooooo#..\n' +
            '..##################..\n' +
            '......................\n',

            '.......||||||||.......\n' +
            '..#.@..............#..\n' +
            '..####....oo.......#..\n' +
            '..#.......oo.......#..\n' +
            '..#.......oo.......#..\n' +
            '..#.......oo.......#..\n' +
            '..#.......oo.......#..\n' +
            '..#+...oooooooo...+#..\n' +
            '..#++...oooooo...++#..\n' +
            '..#+++...oooo...+++#..\n' +
            '..#++++...oo...++++#..\n' +
            '..##################..\n' +
            '......................\n',

            '...........v.|.v......\n' +
            '..#.@..............#..\n' +
            '..#..........o.....#..\n' +
            '..#.........ooo....#..\n' +
            '..#........ooooo...#..\n' +
            '..###.#######.###..#..\n' +
            '..#=....=.....=....#..\n' +
            '..#oooooooooooooooo#..\n' +
            '..##################..\n' +
            '......................\n',

            '......................\n' +
            '..#...++++++...oo..#..\n' +
            '..#..++ooo++.......#..\n' +
            '..#.++oooo++..=....#..\n' +
            '..#.+ooo+++........#..\n' +
            '..#.+oo++.=........#..\n' +
            '..#................#..\n' +
            '..#.@..............#..\n' +
            '..#................#..\n' +
            '..##################..\n' +
            '......................\n',

            '...............................\n' +
            '.#############################.\n' +
            '.#+o+o+o+o+o+o+o+o+o+o+o+o+o+#.\n' +
            '.#+o+o+o+o+o+o+o+o+o+o+o+o+o+#.\n' +
            '.#+o+o+o+o+o+o+o+o+o+o+o+o+o+#.\n' +
            '.#......=............=.......#.\n' +
            '.#...@.....=......=..........#.\n' +
            '.#############################.\n' +
            '...............................\n',

            '.......................................\n' +
            '.#####################################.\n' +
            '.#=.........++..o..++....oo....++oooo#.\n' +
            '.#=..........o.....++....oo....++....#.\n' +
            '.#=..........o.....++....++....++....#.\n' +
            '.#=........o++.....oo....++....oo....#.\n' +
            '.#=....@...o++.....oo....++....oo....#.\n' +
            '.#####################################.\n' +
            '.......................................\n',

            '.......................................\n' +
            '.#####################################.\n' +
            '.#.......o......|...|...|.oo|...|.vv.#.\n' +
            '.#....................o...........oo.#.\n' +
            '.#...oo..........oo..................#.\n' +
            '.#...++#......................oo.....#.\n' +
            '.#...++#.............................#.\n' +
            '.#.@....oooo=#oooo=ooooo++ooooooooo.=#.\n' +
            '.#####################################.\n' +
            '.......................................\n',

            '.......................................\n' +
            '.#####################################.\n' +
            '.#...|.#ooooo...............+++++++..#.\n' +
            '.#...o.#vovov...............oooooo+..#.\n' +
            '.#...o.#....................oooooo+..#.\n' +
            '.#...o.#....................+++++++..#.\n' +
            '.#...|......................#######..#.\n' +
            '.#.............................|||...#.\n' +
            '.#.....##############................#.\n' +
            '.#.....#ooooo.........=........ooo...#.\n' +
            '.#...@.#ooooo.........=........ooo...#.\n' +
            '.#####################################.\n' +
            '.......................................\n',

            '......................\n' +
            '.###################..\n' +
            '.#.................#..\n' +
            '.#.................#..\n' +
            '.#.................#..\n' +
            '.#.................#..\n' +
            '.#.................#..\n' +
            '.###################..\n' +
            '......................\n',

            '.......v..............\n' +
            '..#......|.........#..\n' +
            '..#..............=.#..\n' +
            '..#.........o.o....#..\n' +
            '..#.@......#####...#..\n' +
            '..#####............#..\n' +
            '......#++++++++++++#..\n' +
            '......##############..\n' +
            '......................\n',

            '......................\n' +
            '..#................#..\n' +
            '..#..............=.#..\n' +
            '..#.........o.o....#..\n' +
            '..#.@......#####...#..\n' +
            '..#####............#..\n' +
            '......#++++++++++++#..\n' +
            '......##############..\n' +
            '......................\n'
        ];

        FACT_ARRAY = [
            "Coronaviruses are a large family of viruses which may cause illness in animals " +
            "or humans. In humans several coronaviruses are known to cause respratory infections " +
            "ranging from the comon cold to more severe diseases",

            "COVID-19 spreads primarily from person to person through small droplets from the nose or " +
            "mouth, which are expelled when an infected person coughs, sneezes or speaks. These " +
            "droplets are relatively heavy and do not travel far.",

            "COVID-19 can be caught by someone with only a mild cough, many people with covid only " +
            "experience mild symptoms",

            "Practicing hand and respratory hygiene is the best way to protect yourself and others. " +
            "When possible maintain at least a 1 metre (3 feet) distance between yourself and others.",

            "Those who are experiencing fever, cough or other COVID-19 symptoms should self-isolate for  " +
            "2 weeks, monitering their symptoms daily. if they develop difficulty breathing, " +
            "contact your healthcare providor immediately.",

            "Children and adolescents have just as likely of a chance of becoming infected as an adult " +
            "They are less likely however to become severely sick.",

            "Avoid touching your eyes, nose and mouth. This is an easy way for viruses to enter your " +
            "body from your hands",

            "Avoid going to crowded places. Doing so will increase the chance of exposure to someone " +
            "who has COVID-19",

            "There is no vaccine or cure against COVID-19 yet. Possible vaccines and some specific " +
            "drug treatments are under investigation.",

            "The time between exposure to COVID-19 and the moment symptoms start is commonly around " +
            "five to six days but can range from 1 - 14 days.",

            "It has been proven that cats and dogs can catch COVID-19 from their owners, but there is " +
            "no edidence that these animals can transmit infections to humans.",

            "COVID-19 can survive for up to 72 hours on plastic and stainless steel, less than 24 on " +
            "cardboard and less than 4 on copper. Though COVID-19 can be cleaned from surfaces using " +
            "a disinfectant.",

            "Antibiotics do not help protect from COVID-19, antibiotics work against bacterial infections",

            "Older adults and people of any age who have serious underlying medical conditions may be at " +
            "higher risk for more serious complications form COVID-19",

            "Someone who has completed quaretine or has been released form isolation does not pose a risk " +
            "of infection to other people",

            "Face coverings are recommended while in public, this may reduce your exposure to the virus " +
            "and will help prevent you from passing your infection to others if you are non-symptomatic. " +
            "Face masks should be washed regularly",

            "Cover your sneezes and coughs with your elbow, or preferably a tissue that is immediately disposed of",

            "COVID-19 symptoms to look for are: fever, cough and shortness of breath.",

            "Other coronaviruses include Middle East Respratory Syndrome (MERS), and Severe Acute Respriratory " +
            "Syndrome (SARS)"
        ];
        ///let bgAudio = new Audio("sounds/Hdhdhd.wav");
        let coinAudio = new Audio("sounds/Coin.wav");
        let loseAudio = new Audio("sounds/Lose.wav");
        let winAudio = new Audio("sounds/Win.wav");
        //bgAudio.load();
        coinAudio.load();
        coinAudio.volume = 0.5;
        loseAudio.load();
        loseAudio.volume = 0.5;
        winAudio.load();
        winAudio.volume = 0.5;

        let levelNum = 0
        let lives = 0;

        //button toggles for D-pad
        let leftButt = false;
        let rightButt = false;
        let upButt = false;
        let downButt = false;
        let aButt = false;

        //functions for toggling
        function aButtT() {
            aButt = true;
        }

        function aButtF() {
            aButt = false;
        }

        function rightButtT() {
            rightButt = true;
        }

        function rightButtF() {
            rightButt = false;
        }

        function leftButtT() {
            leftButt = true;
        }

        function leftButtF() {
            leftButt = false;
        }

        function upButtT() {
            upButt = true;
        }

        function upButtF() {
            upButt = false;
        }

        function downButtT() {
            downButt = true;
        }

        function downButtF() {
            downButt = false;
        }

        function allFalse() {
            upButt = false;
            downButt = false;
            leftButt = false;
            rightButt = false;
        }

        function next() {
            wait = false;
        }



      





        class Level {
            constructor(plan) {
                //takes in level string and creates a matrix of symbols
                let rows = plan.trim().split("\n").map(l => [...l]);
                //height
                this.height = rows.length;
                //width
                this.width = rows[0].length;
                //contains moving Objects
                this.startActors = [];

                //goes through the matrix and checks the current symbol against the array "levelChars"
                //if the symbol represents a background object it returns the type of background object
                //else it creates an object related to the symbol and stores it in the "startActors" array
                //then returns empty so that the background is displayed
                this.rows = rows.map((row, y) => {
                    return row.map((ch, x) => {
                        let type = levelChars[ch];
                        if (type == "puzbox") console.log("its Puzzzz")
                        if (type == "puzbox"){
                            type = PuzBox;
                            let gg = type.create(new Vec(x, y), ch);
                            this.startActors.push(gg);
                            return "puzchk";
                        }
                        if (typeof type == "string") {
                            return type;
                        }
                        let gg = type.create(new Vec(x, y), ch);
                        this.startActors.push(gg);
                        return "empty";

                    });
                });
            }
        }
        //used to track and alter the gameplay state
        class State {
            constructor(level, actors, status) {
                this.level = level;
                this.actors = actors;
                this.status = status;
            }
            static start(level) {
                return new State(level, level.startActors, "playing");
            }
            get player() {
                return this.actors.find(a => a.type == "player");
            }
        }
        //used to represent a vector
        class Vec {
            constructor(x, y) {
                this.x = x;
                this.y = y;
            }
            plus(other) {
                return new Vec(this.x + other.x, this.y + other.y);
            }
            times(factor) {
                return new Vec(this.x * factor, this.y * factor);
            }
        }
        //player object
        class Player {
            constructor(pos, speed) {
                this.pos = pos;
                this.speed = speed;
            }
            get type() {
                return "player";
            }
            static create(pos) {
                return new Player(pos.plus(new Vec(0, -0.5)), new Vec(0, 0));
            }
        }
        Player.prototype.size = new Vec(0.8, 1.5);
        //moving box object
        class Box {
            constructor(pos, speed, reset) {
                this.pos = pos;
                this.speed = speed;
                this.reset = reset;
            }
            get type() {
                return "box";
            }
            static create(pos, ch) {
                if (ch == "=") {
                    return new Box(pos, new Vec(2, 0));
                } else if (ch == "|") {
                    return new Box(pos, new Vec(0, 2));
                }
            }
        }
        Box.prototype.size = new Vec(1, 1);

        class UpBox {
            constructor(pos, speed, reset, count) {
                this.pos = pos;
                this.speed = speed;
                this.reset = reset;
                this.count = count;
            }
            upCount(){
                this.count = false;
            }
            get type() {
                return "upbox";
            }
            static create(pos, ch) {
                if (ch == "&") {
                    return new UpBox(pos, new Vec(0, 0), 0, true);
                } 
            }
        }
        UpBox.prototype.size = new Vec(1, 1);

        class PuzBox {
            constructor(pos, speed, reset, count) {
                this.pos = pos;
                this.speed = speed;
                this.reset = reset;
                this.count = count;
            }
            upCount(){
                this.count = false;
            }
            get type() {
                return "puzbox";
            }
            static create(pos, ch) {
                if (ch == "p") {
                    return new PuzBox(pos, new Vec(0, 0), 0, true);
                } 
            }
        }
        PuzBox.prototype.size = new Vec(1, 1);

        //Arrow block object(still called Lava cause Im lazy)
        class Lava {
            constructor(pos, speed, reset) {
                this.pos = pos;
                this.speed = speed;
                this.reset = reset;
            }
            get type() {
                return "lava";
            }
            static create(pos, ch) {
                if (ch == "v") {
                    return new Lava(pos, new Vec(0, 3), pos);
                }
            }
        }
        Lava.prototype.size = new Vec(1, 1);
        //coin object
        class Coin {
            constructor(pos, basePos, wobble) {
                this.pos = pos;
                this.basePos = basePos;
                this.wobble = wobble;
            }
            get type() {
                return "coin";
            }
            static create(pos) {
                let basePos = pos.plus(new Vec(0.2, 0.1));
                return new Coin(basePos, basePos, Math.random() * Math.PI * 2);
            }
        }
        Coin.prototype.size = new Vec(0.6, 0.6);
        //used by level class to determine what is in grid position
        const levelChars = {
            ".": "empty",
            "#": "wall",
            "+": "lava",
            "@": Player,
            "o": Coin,
            "=": Box,
            "|": Box,
            "v": Lava,
            "&": UpBox,
            "p": "puzbox"
        }
        //makes things and appends them to things
        function elt(name, attrs, ...children) {
            let dom = document.createElement(name);
            for (let attr of Object.keys(attrs)) {
                dom.setAttribute(attr, attrs[attr]);
            }
            for (let child of children) {
                dom.appendChild(child);
            }
            return dom;
        }
        //makes parent div and 
        class DOMDisplay {
            constructor(parent, level) {
                this.dom = elt("div", {
                    class: "game"
                }, drawGrid(level));
                this.actorLayer = null;
                document.getElementById("gameDiv").appendChild(this.dom);
            }
            clear() {
                this.dom.remove();
            }
        }

        const scale = 25;

        function drawGrid(level) {
            return elt("table", {
                class: "background",
                id: "gameBack",
                style: `width: ${level.width * scale}px`
            }, ...level.rows.map(row =>
                elt("tr", {
                        style: `height: ${scale}px`
                    },
                    ...row.map(type => elt("td", {
                        class: type
                    })))
            ));
        }

        function drawActors(actors) {
            return elt("div", {}, ...actors.map(actor => {
                let rect = elt("div", {
                    class: `actor ${actor.type}`
                });
                rect.style.width = `${actor.size.x * scale}px`;
                rect.style.height = `${actor.size.y * scale}px`;
                rect.style.left = `${actor.pos.x * scale}px`;
                rect.style.top = `${actor.pos.y * scale}px`;
                return rect;
            }));
        }

        DOMDisplay.prototype.syncState = function (state) {
            if (this.actorLayer) this.actorLayer.remove();
            this.actorLayer = drawActors(state.actors);
            this.dom.appendChild(this.actorLayer);
            this.dom.className = `game ${state.status}`;
            this.scrollPlayerIntoView(state);
        };

        DOMDisplay.prototype.scrollPlayerIntoView = function (state) {
            let width = this.dom.clientWidth;
            let height = this.dom.clientHeight;
            let margin = width / 3;

            //viewport
            let left = this.dom.scrollLeft,
                right = left + width;
            let top = this.dom.scrollTop,
                bottom = top + height;

            let player = state.player;
            let center = player.pos.plus(player.size.times(0.5)).times(scale);

            if (center.x < left + margin) {
                this.dom.scrollLeft = center.x - margin;
            } else if (center.x > right - margin) {
                this.dom.scrollLeft = center.x + margin - width;
            }
            if (center.y < top + margin) {
                this.dom.scrollTop = center.y - margin;
            } else if (center.y > bottom - margin) {
                this.dom.scrollTop = center.y + margin - height;
            }
        };

        Level.prototype.touches = function (pos, size, type) {
            let xStart = Math.floor(pos.x);
            let xEnd = Math.ceil(pos.x + size.x);
            let yStart = Math.floor(pos.y);
            let yEnd = Math.ceil(pos.y + size.y);

            for (let y = yStart; y < yEnd; y++) {
                for (let x = xStart; x < xEnd; x++) {
                    let isOutside = x < 0 || x >= this.width ||
                        y < 0 || y >= this.height;
                    let here = isOutside ? "wall" : this.rows[y][x];
                    if (here == type) return true;
                }
            }
            return false;
        };

        Level.prototype.touches2 = function (pos, size, type) {
            let xStart = Math.floor(pos.x);
            let xEnd = Math.ceil(pos.x + size.x);
            let yStart = Math.floor(pos.y);
            let yEnd = Math.ceil(pos.y + size.y);

            for (let y = yStart; y < yEnd; y++) {
                for (let x = xStart; x < xEnd; x++) {
                    
                    if (this.rows[y][x -1] == type) return true;
                    if (this.rows[y][x +1] == type) return true;
                    if (this.rows[y -1][x] == type) return true;
                    if (this.rows[y +1][x] == type) return true;
                    let here = this.rows[y][x];
                    if (here == type) return true;
                }
            }
            return false;
        };


        function overlap(actor1, actor2) {
            return actor1.pos.x + actor1.size.x > actor2.pos.x &&
                actor1.pos.x < actor2.pos.x + actor2.size.x &&
                actor1.pos.y + actor1.size.y > actor2.pos.y &&
                actor1.pos.y < actor2.pos.y + actor2.size.y;
        }

        Lava.prototype.collide = function (state) {
            loseAudio.play();
            lives -= 1;
            return new State(state.level, state.actors, "lost");
        };

        Box.prototype.collide = function (state) {  
            loseAudio.play();
            lives -= 1;
            return new State(state.level, state.actors, "lost");
        };

        UpBox.prototype.collide = function (state) {
            if (this.count){
                lives += 1;
                this.upCount();
            }
            console.log("Upbox count: " + this.count)
            document.getElementById("livesText").innerHTML = "Lives: " + lives;
            return new State(state.level, state.actors, "playing");
        };

        PuzBox.prototype.collide = function (state) {
            return new State(state.level, state.actors, "playing");
        };

        Coin.prototype.collide = function (state) {
            coinAudio.currentTime = 0;
            coinAudio.play();
            let filtered = state.actors.filter(a => a != this);
            let status = state.status;
            if (!filtered.some(a => a.type == "coin")) status = "won";
            return new State(state.level, filtered, status);
        };

        Lava.prototype.update = function (time, state) {
            let newPos = this.pos.plus(this.speed.times(time));
            if (!state.level.touches(newPos, this.size, "wall")) {
                return new Lava(newPos, this.speed, this.reset);
            } else if (this.reset) {
                return new Lava(this.reset, this.speed, this.reset);
            } else {
                return new Lava(this.pos, this.speed.times(-1));
            }
        };

        Box.prototype.update = function (time, state) {
            let newPos = this.pos.plus(this.speed.times(time));
            if (!state.level.touches(newPos, this.size, "wall")) {
                return new Box(newPos, this.speed, this.reset);
            } else if (this.reset) {
                return new Box(this.reset, this.speed, this.reset);
            } else {
                return new Box(this.pos, this.speed.times(-1));
            }
        };

        UpBox.prototype.update = function (time, state, keys) {
            let newPos = this.pos.plus(this.speed.times(time));
            if (!state.level.touches(newPos, this.size, "wall")) {
                return new UpBox(newPos, this.speed, this.reset, this.count);
            } 
        };

        PuzBox.prototype.update = function (time, state, keys) {
            let player = state.player;
            if (state.level.touches2(player.pos, player.size, this)){
                console.log("in moveboxxxxx")
                let newPos = player.pos.plus(player.size);
                return new PuzBox(newPuz, this.speed, this.reset, this.count);
            }
            let newPos = this.pos.plus(this.speed.times(time));
            if (!state.level.touches(newPos, this.size, "wall")) {
                return new PuzBox(newPos, this.speed, this.reset, this.count);
            } 
        };

        const wobbleSpeed = 8;
        const wobbleDist = 0.07;

        Coin.prototype.update = function (time) {
            let wobble = this.wobble + time * wobbleSpeed;
            let wobblePos = Math.sin(wobble) * wobbleDist;
            return new Coin(this.basePos.plus(new Vec(0, wobblePos)), this.basePos, wobble);
        };

        const playerXSpeed = 5;

        Player.prototype.update = function (time, state, keys) {
            let xSpeed = 0;
            if (keys.ArrowLeft || leftButt) {
                xSpeed -= playerXSpeed;
                //allFalse();
            }
            if (keys.ArrowRight || rightButt) {
                xSpeed += playerXSpeed;
                //allFalse();
            }
            let pos = this.pos;
            let movedX = pos.plus(new Vec(xSpeed * time, 0));
            if (!state.level.touches(movedX, this.size, "wall") && !state.level.touches(movedX, this.size, "puzchk")) {
                pos = movedX;
            }
            let ySpeed = 0;
            if (keys.ArrowUp || upButt) {
                ySpeed -= playerXSpeed;
                //allFalse();
            }
            if (keys.ArrowDown || downButt) {
                ySpeed += playerXSpeed;
                //allFalse();
            }
            let movedY = pos.plus(new Vec(0, ySpeed * time));
            if (!state.level.touches(movedY, this.size, "wall") && !state.level.touches(movedY, this.size, "puzchk")) {
                pos = movedY;
            }
            return new Player(pos, new Vec(xSpeed, ySpeed));

        };

        State.prototype.update = function (time, keys) {
            let actors = this.actors.map(actor => actor.update(time, this, keys));
            let newState = new State(this.level, actors, this.status);
            console.log("in the State.update: " + newState.status);
            if (newState.status != "playing") return newState;

            let player = newState.player;
            if (this.level.touches(player.pos, player.size, "lava")) {
                lives -= 1;
                return new State(this.level, actors, "lost");
            } else if (this.level.touches(player.pos, player.size, "box")) {
                return new State(this.level, actors, "lost");
            } else if (this.level.touches(player.pos, player.size, "upbox")){
                lives += 1;
                return new State(this.level, actors, "playing");
            } else if (this.level.touches(player.pos, player.size, "puzbox")){

            }

            for (let actor of actors) {
                if (actor != player && overlap(actor, player)) {
                    if(actor.type == "puzbox") gg++;
                    console.log("actor type: " + actor.type);
                    newState = actor.collide(newState);
                }
            }
            return newState;
        };

        function trackKeys(keys) {
            let down = Object.create(null);

            function track(event) {
                if (keys.includes(event.key)) {
                    down[event.key] = event.type == "keydown";
                    event.preventDefault();
                }
            }
            window.addEventListener("keydown", track);
            window.addEventListener("keyup", track);
            return down;
        }

        const arrowKeys = trackKeys(["ArrowLeft", "ArrowRight", "ArrowUp", "ArrowDown", "KeyA"]);

        function runAnimation(frameFunc) {
            let lastTime = null;

            function frame(time) {
                if (lastTime != null) {
                    let timeStep = Math.min(time - lastTime, 100) / 1000;
                    if (frameFunc(timeStep) === false) return;
                }
                lastTime = time;
                requestAnimationFrame(frame);
            }
            requestAnimationFrame(frame);
        }

        let curLev = 0;

        function runLevel(level, Display) {
            let display = new Display(document.body, level);
            let state = State.start(level);
            let ending = 1;
            return new Promise(resolve => {
                runAnimation(time => {
                    state = state.update(time, arrowKeys);
                    display.syncState(state);
                    if (state.status == "playing") {
                        return true;
                    } else if (ending > 0) {
                        ending -= time;
                        return true;
                    } else {
                        display.clear();
                        resolve(state.status);
                        return false;
                    }
                });
            });
        }

        function runRunGame(){  

        }

        async function runGame(plans, Display) {
            lives = 5;
            document.getElementById('homeDiv').style.display = "none";
            document.getElementById('loseDiv').style.display = "none";
            document.getElementById('buttonDiv').style.visibility = "visible";
            for (let level = 0; level < plans.length;) {
                let fact = Math.floor(Math.random()*FACT_ARRAY.length);
                console.log("fact number: " + fact);
                document.getElementById("factText").innerHTML = FACT_ARRAY[fact];
                document.getElementById("levelText").innerHTML = "Level: " + (level + 1);
                document.getElementById("livesText").innerHTML = "Lives: " + lives;
                console.log("Level: " + (level + 1));
                console.log("lives: " + lives);
                let status = await runLevel(new Level(plans[level]), Display);
                if (status == "won") level++;
                else if (lives == 0) {
                    console.log("You Lose!!");
                    loseAudio.play();
                    break
                } else if (level == plans.length) {
                    console.log("Youve won!");
                    winAudio.play();
                    break;
                }
                
            }
            document.getElementById('loseDiv').style.display = "block";

        }



        function main(){
            document.getElementById('homeDiv').style.display = "block";
            document.getElementById('loseDiv').style.display = "none";
            document.getElementById('buttonDiv').style.visibility = "hidden";

        }
        main();
    </script>



</body>

</html>